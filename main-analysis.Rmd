---
title: "Geospatial Analysis of Aid Data in Africa"
output: html_notebook
---

## Motivation

## Data

The data for all aid projects across all 54 countries in Africa was retrieved from [d-portal](https://d-portal.org/ctrack.html?country_code=DZ%2CAO%2CBJ%2CBW%2CBF%2CBI%2CCV%2CCM%2CCF%2CTD%2CKM%2CCD%2CCG%2CCI%2CDJ%2CEG%2CGQ%2CER%2CSZ%2CET%2CGA%2CGM%2CGH%2CGN%2CGW%2CKE%2CLS%2CLR%2CLY%2CMG%2CMW%2CML%2CMR%2CMU%2CMZ%2CNA%2CNE%2CRW%2CST%2CSN%2CSC%2CSL%2CSO%2CZA%2CSS%2CSD%2CTZ%2CTG%2CTN%2CUG%2CZM%2CZW#view=main) (link already queries for all 54 countries). In total, 269,058 activites were recorded across 1148 IATI organisations of which 26% had exact geo-locations. Subject to this analysis is the subsample of aid projects that have exact geo-locations.  

Missionary data is retrived from [Harvard Dataverse](https://dataverse.harvard.edu/dataset.xhtml;jsessionid=007b01ae9a7dd5ebe43548b06261?persistentId=doi%3A10.7910%2FDVN%2FRBCHZ9&version=&q=&fileTypeGroupFacet=&fileAccess=)

In the first visualations, please find a map including all xxx aid projects which were retrieved from d-portal.

```{r echo=FALSE}
# House keeping ----------------------------------------------------------------
rm(list = ls())

# Packages ----------------------------------------------------------------

# Packages to load
pckg_to_load_ext <- c("data.table", "sf", "openxlsx", "zoo", "utils", "ggplot2")


# Load packages silently
suppressPackageStartupMessages(
  invisible(lapply(pckg_to_load_ext, library, character.only = TRUE))
)

# Setting directories ----------------------------------------------------
wd <- getwd() # "your path"
setwd(wd)

# Controls ---------------------------------------------------------------
africa_countries <- c("Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Democratic Republic of the Congo" ,"Djibouti", "Egypt", "Equatorial Guinea", "Eritrea","Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Côte d'Ivoire", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Nigeria", "Republic of the Congo" ,"Rwanda", "São Tomé and Príncipe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan","Swaziland", "Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe")

```

```{r}
library(sf)
library(data.table)
library(tidyr)

aiddata <- read.csv("data/dportal_map_activities.csv")
sf_aiddata <- st_as_sf(aiddata, coords = c("location_longitude", "location_latitude"), crs = "ESRI:102022")

head(sf_aiddata)

boundaries <- st_read("data/gadm_410.gpkg")
africa_boundaries <- boundaries[boundaries$COUNTRY %in% africa_countries,]

found <- unique(africa_boundaries$COUNTRY)
missing_countries <- setdiff(africa_countries, found)
print(missing_countries)

africa_boundaries <- africa_boundaries %>% st_transform(st_crs(sf_aiddata))

master <- st_join(sf_aiddata, africa_boundaries[c("NAME_1", "ENGTYPE_1", "NAME_2", "ENGTYPE_2", "NAME_3", "ENGTYPE_3", "NAME_4", "ENGTYPE_4")])
boroughs <- master$NAME_1
rev <- aggregate(x = master["aid"], by = boroughs, FUN = mean)
rev$name <- boroughs$namgem
rev
tmap::qtm(rev, fill="revenue")
#mapview::mapview(sf_aiddata)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
